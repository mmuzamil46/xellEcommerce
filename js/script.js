// const products= [
//     {
//         id : 1,
//         name : "Men's Jacket",
//         category : 'clothing',
//         desc : "Puma Men Ferrari Black Fleece Jacket",
//         rate : 3.5,
//         price : 2500,
//         stoke : 5,
//         image : "/image/clothing_1.jpg",
//         arriveDate : "2025-01-01"
//     },
//     {
//         id : 2,
//         name : "Women's Jacket",
//         category : 'clothing',
//         desc : "Reebok Knit Rib Women Black Jacket",
//         rate : 4.5,
//         price : 2000,
//         stoke : 5,
//         image : "/image/clothing_2.jpg",
//         arriveDate : "2025-01-02"
//     },
//     {
//         id : 3,
//         name : "Girls Dress",
//         category : 'clothing',
//         desc : "Disney Kids Girls Disney girl pink pooh top Kidswear",
//         rate : 3.5,
//         price : 1500,
//         stoke : 5,
//         image : "/image/clothing_3.jpg",
//         arriveDate : "2025-01-02"
//     },
//     {
//         id : 4,
//         name : "Jeans",
//         category : 'clothing',
//         desc : "Gini and Jony Boys Karnel Jeans",
//         rate : 3.5,
//         price : 1000,
//         stoke : 1,
//         image : "/image/clothing_4.jpg",
//         arriveDate : "2025-01-02"
//     },
//     {
//         id : 5,
//         name : "Dress",
//         category : 'clothing',
//         desc : "Tonga Women Green Dress",
//         rate : 2.5,
//         price : 10000,
//         stoke : 5,
//         image : "/image/clothing_5.jpg",
//         arriveDate : "2025-01-02"
//     },
//     {
//         id : 6,
//         name : "Dress",
//         category : 'clothing',
//         desc : "United Colors of Benetton Girls Printed Navy Blue Dress",
//         rate : 2.5,
//         price : 10000,
//         stoke : 5,
//         image : "/image/clothing_6.jpg",
//         arriveDate : "2025-01-04"
//     },
//     {
//         id : 7,
//         name : "Trouser",
//         category : 'clothing',
//         desc : "Scullers Men Scul Brown Trousers",
//         rate : 2.5,
//         price : 3000,
//         stoke : 5,
//         image : "/image/clothing_7.jpg",
//         arriveDate : "2025-01-05"
//     }

// ]
const products = [
    // Electronics
    {
        id: 1,
        name: "Smartphone",
        category: "Electronics",
        desc: "Samsung Galaxy A54 5G with AMOLED display",
        rate: 4.2,
        price: 45000,
        stoke: 12,
        image: "/image/electronics_1.jpg",
        arriveDate: "2025-01-01"
    },
    {
        id: 2,
        name: "Bluetooth Speaker",
        category: "Electronics",
        desc: "JBL Go 3 Portable Waterproof Speaker",
        rate: 4.5,
        price: 3500,
        stoke: 20,
        image: "/image/electronics_2.jpg",
        arriveDate: "2025-01-02"
    },
    {
        id: 3,
        name: "Wireless Earbuds",
        category: "Electronics",
        desc: "boAt Airdopes 141 ANC True Wireless Earbuds",
        rate: 4.0,
        price: 2500,
        stoke: 15,
        image: "/image/electronics_3.jpg",
        arriveDate: "2025-01-03"
    },

    // Appliances
    {
        id: 4,
        name: "Microwave Oven",
        category: "Appliances",
        desc: "LG 20 L Solo Microwave Oven with Smart Inverter",
        rate: 3.8,
        price: 8999,
        stoke: 6,
        image: "/image/appliances_1.jpg",
        arriveDate: "2025-01-01"
    },
    {
        id: 5,
        name: "Washing Machine",
        category: "Appliances",
        desc: "Samsung 6.5 kg Fully Automatic Front Load Washer",
        rate: 4.3,
        price: 24999,
        stoke: 3,
        image: "/image/appliances_2.jpg",
        arriveDate: "2025-01-02"
    },
    {
        id: 6,
        name: "Air Conditioner",
        category: "Appliances",
        desc: "Voltas 1.5 Ton 3 Star Inverter Split AC",
        rate: 4.1,
        price: 33999,
        stoke: 2,
        image: "/image/appliances_3.jpg",
        arriveDate: "2025-01-03"
    },

    // Clothing
    {
        id: 7,
        name: "Dress",
        category: "Clothing",
        desc: "United Colors of Benetton Girls Printed Navy Blue Dress",
        rate: 2.5,
        price: 10000,
        stoke: 5,
        image: "/image/clothing_6.jpg",
        arriveDate: "2025-01-04"
    },
    {
        id: 8,
        name: "Men's Shirt",
        category: "Clothing",
        desc: "Raymond Men Slim Fit Formal Shirt",
        rate: 3.9,
        price: 1599,
        stoke: 8,
        image: "/image/clothing_2.jpg",
        arriveDate: "2025-01-05"
    },
    {
        id: 9,
        name: "Women's Jacket",
        category: "Clothing",
        desc: "ONLY Women's Green Solid Puffer Jacket",
        rate: 4.6,
        price: 2999,
        stoke: 4,
        image: "/image/clothing_3.jpg",
        arriveDate: "2025-01-06"
    },

    // Shoes
    {
        id: 10,
        name: "Running Shoes",
        category: "Shoes",
        desc: "Nike Men's Revolution 6 Running Shoes",
        rate: 4.4,
        price: 4999,
        stoke: 10,
        image: "/image/shoes_1.jpg",
        arriveDate: "2025-01-02"
    },
    {
        id: 11,
        name: "Formal Shoes",
        category: "Shoes",
        desc: "Bata Men's Leather Formal Shoes",
        rate: 3.7,
        price: 2799,
        stoke: 7,
        image: "/image/shoes_2.jpg",
        arriveDate: "2025-01-04"
    },
    {
        id: 12,
        name: "Sneakers",
        category: "Shoes",
        desc: "Puma Unisex Sneakers",
        rate: 4.5,
        price: 3499,
        stoke: 9,
        image: "/image/shoes_3.jpg",
        arriveDate: "2025-01-05"
    },

    // Watch & Jewellery
    {
        id: 13,
        name: "Men's Watch",
        category: "Watch & Jewllery",
        desc: "Fastrack Analog Watch for Men",
        rate: 4.2,
        price: 2599,
        stoke: 6,
        image: "/image/watch_1.jpg",
        arriveDate: "2025-01-03"
    },
    {
        id: 14,
        name: "Women's Necklace",
        category: "Watch & Jewllery",
        desc: "Zaveri Pearls Gold-Plated Necklace Set",
        rate: 4.6,
        price: 1999,
        stoke: 3,
        image: "/image/watch_2.jpg",
        arriveDate: "2025-01-06"
    },
    {
        id: 15,
        name: "Smartwatch",
        category: "Watch & Jewllery",
        desc: "boAt Xtend Smartwatch with Alexa Built-in",
        rate: 4.1,
        price: 2999,
        stoke: 12,
        image: "/image/watch_3.jpg",
        arriveDate: "2025-01-07"
    },

    // Books
    {
        id: 16,
        name: "Atomic Habits",
        category: "Books",
        desc: "A book by James Clear on habit-building",
        rate: 4.9,
        price: 499,
        stoke: 20,
        image: "/image/books_1.jpg",
        arriveDate: "2025-01-01"
    },
    {
        id: 17,
        name: "The Alchemist",
        category: "Books",
        desc: "A philosophical novel by Paulo Coelho",
        rate: 4.7,
        price: 399,
        stoke: 18,
        image: "/image/books_2.jpg",
        arriveDate: "2025-01-02"
    },
    {
        id: 18,
        name: "Rich Dad Poor Dad",
        category: "Books",
        desc: "Robert Kiyosakiâ€™s guide to financial literacy",
        rate: 4.8,
        price: 450,
        stoke: 25,
        image: "/image/books_3.jpg",
        arriveDate: "2025-01-03"
    }
];
const cart = [];
const fav = [];

$(document).ready(function(){
$("#cart-count").text(cart.length);
$("table").hide();
loadProducts(products)
$('.mobile-menu').hide();
if($(window).width() < 990){
    $('.mobile-menu').hide();

  }
  $(window).resize(function(){
    //if($(window).width() > 728){
      //$('.mobile-menu').hide();
      $(".mobile-menu").slideUp();
      if($('#menu-bar i').hasClass('fa-times')){
          $('#menu-bar i').removeClass('fa-times');
          $('#menu-bar i').addClass('fa-bars');
      }
    //}
});



$('#menu-bar').click(function(e){
    e.stopPropagation();
    $('.mobile-menu').slideToggle();
$(this).find('i').toggleClass('fa-bars fa-times');
    });

    $(document).click(function() {
        if ($('.mobile-menu').is(':visible')) {
            $('.mobile-menu').slideUp();
            $('#menu-bar i').removeClass('fa-times').addClass('fa-bars');
        }
    });
    $('.mobile-menu').click(function(e) {
        e.stopPropagation();
    });

$(".menu").on('click', 'a', function(e){
   // e.preventDefault();
   $(".mobile-menu").slideUp();
   if($('#menu-bar i').hasClass('fa-times')){
       $('#menu-bar i').removeClass('fa-times');
       $('#menu-bar i').addClass('fa-bars');
   }
    if($(this).text() == "Home"){
        $(".banner").show();
        $(".new-arrival").show();
        $(".all-items").removeClass("d-none");
    $(".all-items").addClass("d-flex");
        $("table").hide();
        $(".products h1").text("FOR YOU");
        loadProducts(products);
    } else{
        const filtered = products.filter((element) => element.category.trim().toLowerCase() === $(this).text().trim().toLowerCase());
        console.log(filtered);
        
        $(".banner").hide();
        $(".new-arrival").hide();
        $(".all-items").removeClass("d-none");
        $(".all-items").addClass("d-flex");
        $("table").hide();
        $(".products h1").text($(this).text());
      
        loadProducts(filtered);
    }
    
    
    
})

$('.search').on('focus', 'input', function(){
    $(".mobile-menu").slideUp();
    if($('#menu-bar i').hasClass('fa-times')){
        $('#menu-bar i').removeClass('fa-times');
        $('#menu-bar i').addClass('fa-bars');
    }
})

$('.search').on('click','button', function(){
   const key = $(this).prev().val();
    const filtered = products.filter((element) => element.name.trim().toLowerCase().includes(key.trim().toLowerCase()));
    $(".banner").hide();
    $(".new-arrival").hide();
    $(".all-items").removeClass("d-none");
    $(".all-items").addClass("d-flex");
    $("table").hide();
    $(".products h1").text("Results for " + key);
    if(filtered.length != 0){
        loadProducts(filtered);
    } else {
$('.all-items').html('<h1 class="text-center">No items found</h1>');
$(this).prev().val('');
    }
  

});

    $(".all-items").on('click','.to-cart',function(){
let itemid = $(this).parent().parent().find("h4").text().split("-")[1];

let cartItem = products.find(item => item.id == itemid);
if(cartItem.stoke == 0 ){
    alert("This item is out of stock");
    return;
}
if(cart.find(item => item.id == cartItem.id)){
    if(cart.find(item => item.id == cartItem.id).qty >= cartItem.stoke){
        alert("The quantity you entered is not available in stock");
        $(this).parent().prev().text('out of stoke');
        $(this).parent().prev().css('color', 'red');
        return;
    }
    cart[cart.indexOf(cartItem)].qty += 1;
} else{
    cartItem.qty = 1;
    cart.push(cartItem);
}

$("#cart-count").text(cart.length); 

    });

    $(".all-items").on('click', '.to-fav',function(){
        let itemid = $(this).parent().parent().find("h4").text().split("-")[1];
let favItem = products.find(item => item.id == itemid);
if(fav.find(item => item.id == favItem.id)){
    alert("This item is already in your favorite list");
} else{

    fav.push(favItem);
    alert("This item is added to your favorite list");
}
$('#fav-count').text(fav.length);
// console.log(fav);

    });
$("#cart").click(function(){
    console.log(cart);

    $(".banner").hide();
    $(".new-arrival").hide();
    $(".all-items").removeClass("d-flex");
    $(".all-items").addClass("d-none");
    $("table").show();
    $(".products h1").text("Cart Items");
    $('html, body').animate({
        scrollTop: $('table').offset().top - 200
      }, 100);
   loadCart();
    
})

$('#fav').click(function(){
    $(".banner").hide();
    $(".new-arrival").hide();
    $(".all-items").removeClass("d-none");
    $(".all-items").addClass("d-flex");
    $("table").hide();
    $(".products h1").text("Favorite Items");
    $('html, body').animate({
        scrollTop: $('.all-items').offset().top - 200
      }, 100);
    if(fav.length != 0){
        loadProducts(fav);
    } else{
        $('.all-items').html('<h1 class="text-center">No items found</h1>');
    }

})

$('table').on('change', '#qty', function(){
    let qty = parseInt($(this).val());
    let id = parseInt($(this).parent().siblings('th').text());
    const item = cart.find(item => item.id == id);
    if(qty > item.stoke){
        //$(this).parent().innerHTML += `<p style="color:red">out of stoke</p>`;
       alert("The quantity you entered is not available in stock");
        $(this).val(item.qty);
        return;
    }
    

    let price = $(this).parent().prev().text();
    let total = qty * price;
    $(this).parent().next().text(total);
  
    cart.find(item => item.id == id).qty = qty;
    //console.log(cart.find(item => item.id == id));
    
    //console.log(total);
    let totalPrice = 0;
    $('tbody tr').each(function(){
        totalPrice += parseInt($(this).find('td:last').text());
    });
    //console.log(totalPrice);
    $('#total').text(totalPrice);
    

    
});


$('table').on('click', '#remove', function(){
let itemId = $(this).parent().parent().parent().parent().find('th').text();
cart.splice(cart.indexOf(cart.find(item => item.id == itemId)), 1);
$("#cart-count").text(cart.length); 
loadCart();
//console.log(itemId);


})


let paymentMethod = '';

$('.payment').on('click', 'li' , function(){
paymentMethod = $(this).attr('id');
$(this).addClass('active').siblings().removeClass('active');
//console.log(paymentMethod);
});

$('.checkout').click(function(){
    if(cart.length == 0){
        alert("Your cart is empty");
        return;
    }
    if(paymentMethod == ''){
        alert("Please select a payment method");
        return;
    }
    if(confirm("Are you sure you want to checkout?")){
        alert("Your order has been placed successfully. Thank you for shopping with us.");
        cart.forEach(element => {
            products.find(item => item.id == element.id).stoke -= element.qty;
        })
        cart.splice(0, cart.length);
        $("#cart-count").text(cart.length); 
        $(`#${paymentMethod}`).removeClass('active');
        loadCart();
        paymentMethod = '';
    }



})



if($(window).width() < 768){
    $('.drop').next().hide();

  }
  $(window).resize(function(){
    if($(window).width() < 768){
      $('.drop').next().hide();
    }
});

  $('.drop').click(function(){

// $(this).next().hide();
$(this).next().slideToggle(400);
$(this).children('i').toggleClass('fa-angle-down fa-angle-up')
});
  });


  function loadProducts(itemsToLoad){
    itemsToLoad = shuffleArray(itemsToLoad);
    document.querySelector(".all-items").innerHTML = ""; 
itemsToLoad.forEach(element => {
    document.querySelector(".all-items").innerHTML += `  <div class="one-item">
                    <img src=".${element.image}" alt="" height="300px">
                    <h4>${element.name}-${element.id}</h4>
                    <p id="desc">${element.desc}</p>
                    <p id="price">price:etb${element.price}</p>
                    <span id="rate">
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star-half-stroke"></i>
                    (${element.rate}/5)</span>
                   
                     ${element.stoke > 0 
    ? '<p id="stoke">in stoke</p>' 
    : '<p id="stoke" style="color:red">out of stoke</p>'
  }
                   <div class="d-flex flex-column gap-2">
                    <button class="to-cart">Add to Cart</button>
                    <button class="to-fav">Favorite</button>
                   </div>
                </div>`
});
    
  }
  
  function loadCart(){
   let totalPrice = 0;
document.querySelector('tbody').innerHTML = '';
    cart.forEach(element => {
        document.querySelector('tbody').innerHTML += `
           <tr class="cart-row">
                        <th>${element.id}</th>
                        <td><div class="d-flex gap-3 align-items-center">
                            <img src=".${element.image}" alt="">
                           <div> <h4>${element.name}</h4>
                            <p>${element.desc}</p>
            <span id="remove"><i class="fa-solid fa-trash"></i></span>
            </div>
                        </div></td>
                        <td>${element.price}</td>
                        <td><input type="number" name="" min="1" value="${element.qty}" id="qty" width="35"></td>
                        <td>${element.price * element.qty}</td>
                    </tr>
        
        `
       totalPrice += (element.price * element.qty);

    });
    $('#total').text(totalPrice);
  }



  function shuffleArray(array) {
    const shuffled = [...array]; 
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}